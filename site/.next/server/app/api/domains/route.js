"use strict";(()=>{var e={};e.id=933,e.ids=[933],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},9330:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>E,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l});var r={};a.r(r),a.d(r,{GET:()=>p,dynamic:()=>c});var i=a(9303),s=a(8716),n=a(670),o=a(7070),d=a(1181);let c="force-dynamic";async function p(e){let t=new d.k;try{let e=await t.listDomains();return o.NextResponse.json({domains:e})}catch(e){return console.error("Error fetching domains:",e),o.NextResponse.json({error:"Failed to fetch domains"},{status:500})}finally{await t.close()}}let u=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/domains/route",pathname:"/api/domains",filename:"route",bundlePath:"app/api/domains/route"},resolvedPagePath:"/Users/jaenster/code/claude/mpc-mindport/site/app/api/domains/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:l,serverHooks:h}=u,E="/api/domains/route";function b(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}},1181:(e,t,a)=>{a.d(t,{k:()=>d});let r=require("sqlite3");var i=a.n(r);let s=require("util");var n=a(5315);let o=require("os");class d{constructor(e){let t=n.join(o.homedir(),".config","mindport","data","storage.db");try{this.db=new(i()).Database(e||t),this.dbGet=(0,s.promisify)(this.db.get.bind(this.db)),this.dbAll=(0,s.promisify)(this.db.all.bind(this.db))}catch(e){throw console.error("Database connection error:",e),Error("Could not connect to MindPort database. Make sure the MCP server has been run at least once to create the database.")}}async listDomains(){return(await this.dbAll(`
      SELECT 
        d.name,
        d.description,
        d.created_at,
        COUNT(r.id) as resource_count
      FROM domains d
      LEFT JOIN resources r ON d.name = r.domain
      GROUP BY d.name, d.description, d.created_at
      ORDER BY d.name
    `)).map(e=>({name:e.name,description:e.description,resourceCount:e.resource_count,createdAt:new Date(e.created_at)}))}async listResources(e,t,a,r){let i="SELECT * FROM resources WHERE 1=1",s=[];if(e&&(i+=" AND domain = ?",s.push(e)),r){i+=" AND (name LIKE ? OR description LIKE ? OR content LIKE ?)";let e=`%${r}%`;s.push(e,e,e)}return i+=" ORDER BY updated_at DESC",t&&(i+=" LIMIT ?",s.push(t),a&&(i+=" OFFSET ?",s.push(a))),(await this.dbAll(i,...s)).map(e=>({id:e.id,name:e.name,description:e.description,content:e.content,tags:JSON.parse(e.tags||"[]"),domain:e.domain,mimeType:e.mime_type,uri:e.uri,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}async getResource(e){let t=await this.dbGet("SELECT * FROM resources WHERE id = ?",e);return t?{id:t.id,name:t.name,description:t.description,content:t.content,tags:JSON.parse(t.tags||"[]"),domain:t.domain,mimeType:t.mime_type,uri:t.uri,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}:null}async listPrompts(e){let t="SELECT * FROM prompts",a=[];return e&&(t+=" WHERE domain = ?",a.push(e)),t+=" ORDER BY updated_at DESC",(await this.dbAll(t,...a)).map(e=>({id:e.id,name:e.name,description:e.description,template:e.template,variables:JSON.parse(e.variables||"[]"),domain:e.domain,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}async getPrompt(e){let t=await this.dbGet("SELECT * FROM prompts WHERE id = ?",e);return t?{id:t.id,name:t.name,description:t.description,template:t.template,variables:JSON.parse(t.variables||"[]"),domain:t.domain,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}:null}async getStats(){let[e,t,a]=await Promise.all([this.dbGet("SELECT COUNT(*) as count FROM resources"),this.dbGet("SELECT COUNT(*) as count FROM prompts"),this.dbGet("SELECT COUNT(*) as count FROM domains")]),r=await this.listResources(void 0,5);return{totalResources:e.count,totalPrompts:t.count,totalDomains:a.count,recentResources:r}}close(){return new Promise((e,t)=>{this.db.close(a=>{a?t(a):e()})})}}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(9330));module.exports=r})();